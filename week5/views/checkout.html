<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>checkout</title>
  <!-- bootStrapCss -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <!-- vueLoadingCss -->
  <link href="https://cdn.jsdelivr.net/npm/vue-loading-overlay@6/dist/css/index.css" rel="stylesheet">
  <!-- googleMaterialIcon -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <!-- localCss -->
  <link rel="stylesheet" href="../css/main.css">
  <style>
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* Firefox */
    input[type=number] {
      -moz-appearance: textfield;
    }
  </style>
</head>

<body>
  <div id="app">
    <loading v-if="isLoading" :active="isLoading" :background-color="'#EBEAE4'" :is-full-page="true" :color="'#52504B'">
    </loading>
    <div v-else class="container bg-main-medi rounded-10em mt-5 mb-5 px-5r py-7r">
      <!-- å¤§æ¨™é¡Œ -->
      <div class="d-flex align-items-center justify-content-center mb-3">
        <h2 class="text-center border-bottom border-secondary pb-2 w-25">çµå¸³</h2>
      </div>
      <!-- è©³ç´°å…§å®¹ -->
      <div class="row">
        <!-- è©³ç´°å…§å®¹å·¦ -->
        <div class="col">
          <div class="accordion" id="accordionPanelsStayOpenExample">
            <!-- è³¼ç‰©è»Š -->
            <div class="accordion-item">
              <!-- ShoppingCartSection -->
              <h2 class="accordion-header" id="ShoppingCartSection">
                <button class="accordion-button fs-5 fw-semibold text-deep-gray" type="button" data-bs-toggle="collapse"
                  data-bs-target="#ShoppingCartDetails" aria-expanded="true" aria-controls="ShoppingCartDetails">
                  è³¼ç‰©è»Š
                </button>
              </h2>
              <!-- ShoppingCartDetails -->
              <div id="ShoppingCartDetails" class="accordion-collapse collapse show"
                aria-labelledby="ShoppingCartSection">
                <div class="accordion-body">
                  <div class="" v-if="cartsData.length === 0">
                    ç›®å‰è³¼ç‰©è»Šå…§æ²’æœ‰å•†å“
                  </div>
                  <div v-else class="">
                    <div class="row mb-3 position-relative" v-for="item in cartsData" :key="item.id">
                      <loading :active="item.isSmLoading" :is-full-page="false" :color="'#52504B'">
                      </loading>
                      <div class="col-3 d-flex align-items-center">
                        <img :src="item.product.imageUrl" :alt="item.product.title" class="img-fluid">
                      </div>
                      <div class="col-9">
                        <div class="d-flex">
                          <h6>{{item.product.title}}</h6>
                          <button type="button" class="btn-close" aria-label="Close"
                            @click="deleteCart(item.id)"></button>
                        </div>
                        <p>å–®åƒ¹NT$ {{ parseInt(item.product.price) }} / å°è¨ˆNT$ {{ parseInt(item.total) }} <span
                            v-if="item.final_total !== item.total">/ å„ªæƒ åƒ¹NT$ {{ parseInt(item.final_total) }} </span>
                        </p>

                        <quantity-control-btns :inventory="item.product.inventory" :id="item.product_id" :qty="item.qty"
                          :product-cart-id="item.id" @put-num="putCart"></quantity-control-btns>
                      </div>
                    </div>
                    <!-- æ¸…ç©ºè³¼ç‰©è»ŠæŒ‰éˆ• -->
                    <div class="d-flex mb-3" v-if="cartsData.length > 1">
                      <button type="button" class="btn btn-outline-mdgray w-100" @click="deleteCarts">æ¸…ç©ºè³¼ç‰©è»Š</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- è¨‚å–®ç¢ºèª -->
            <div class="accordion-item" v-if="cartsData.length !== 0">
              <!-- OrderConfirmationSection -->
              <h2 class="accordion-header" id="OrderConfirmationSection">
                <button class="accordion-button fs-5 fw-semibold collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#OrderConfirmationDetails" aria-expanded="false"
                  aria-controls="OrderConfirmationDetails">
                  è¨‚å–®ç¢ºèª
                </button>
              </h2>
              <!-- OrderConfirmationDetails -->
              <div id="OrderConfirmationDetails" class="accordion-collapse collapse show"
                aria-labelledby="OrderConfirmationSection">
                <div class="accordion-body">
                  <!-- å•†å“ç¸½é‡‘é¡ -->
                  <div class="d-flex justify-content-between">
                    <p>å•†å“ç¸½é‡‘é¡</p>
                    <p>NT$ {{ parseInt(allCartsData.total) }}</p>
                  </div>
                  <!-- é‹è²» -->
                  <div class="d-flex justify-content-between">
                    <p>é‹è²»</p>
                    <p>å…é‹è²»</p>
                  </div>
                  <div v-if="!allCartsData.useCoupon">
                    <!-- ä½¿ç”¨å„ªæƒ ä»£ç¢¼1 -->
                    <div class="d-flex justify-content-between" v-if="!useCoupon">
                      <p>å„ªæƒ ä»£ç¢¼</p>
                      <button type="button" class="btn btn-outline-dpgray" @click="useCoupon = true">ä½¿ç”¨å„ªæƒ ä»£ç¢¼</button>
                    </div>
                    <!-- ä½¿ç”¨å„ªæƒ ä»£ç¢¼2 -->
                    <div class="mb-3" v-else-if="useCoupon">
                      <p class="w-25">å„ªæƒ ä»£ç¢¼</p>
                      <div class="d-flex justify-content-between align-items-center">
                        <input type="text" class="form-control" id="category" placeholder="è«‹å¡«å…¥å„ªæƒ ä»£ç¢¼"
                          v-model="couponCode">
                        <button type="button" class="w-25 btn btn-outline-dpgray ms-3"
                          @click="goToPostCoupon">ä½¿ç”¨</button>
                        <button type="button" class="w-25 btn btn-outline-dpgray ms-3"
                          @click="useCoupon = false">å–æ¶ˆ</button>
                      </div>
                    </div>
                  </div>
                  <!-- ä½¿ç”¨å„ªæƒ ä»£ç¢¼3 -->
                  <div class="d-flex justify-content-between" v-if="allCartsData.useCoupon">
                    <p>ä½¿ç”¨å„ªæƒ åˆ¸</p>
                    <p>å„ªæƒ  NT$ {{ parseInt(allCartsData.total) - parseInt(allCartsData.final_total) }}</p>
                  </div>
                  <hr>
                  <!-- ç¸½ä»˜æ¬¾é‡‘é¡ -->
                  <div class="d-flex justify-content-between" v-if="!allCartsData.useCoupon">
                    <p>ç¸½ä»˜æ¬¾é‡‘é¡</p>
                    <h4 class="text-end">NT$ {{ parseInt(allCartsData.total) }}</h4>
                  </div>
                  <!-- ç¸½ä»˜æ¬¾é‡‘é¡2 -->
                  <div class="" v-else-if="allCartsData.useCoupon">
                    <div class="d-flex justify-content-between">
                      <p>ç¸½ä»˜æ¬¾é‡‘é¡</p>
                      <h5 class="text-decoration-line-through">NT$ {{ parseInt(allCartsData.total) }}</h5>
                    </div>
                    <h4 class="text-end">NT$ {{ parseInt(allCartsData.final_total) }}</h4>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- è©³ç´°å…§å®¹å³ -->
        <div class="col">
          <div class="accordion" id="accordionPanelsStayOpenExample">
            <!-- è¯çµ¡æˆ‘å€‘ -->
            <div class="accordion-item" v-if="cartsData.length === 0">
              <!-- ContactUsSection -->
              <h2 class="accordion-header" id="ContactUsSection">
                <button class="accordion-button collapsed fs-5 fw-semibold" type="button" data-bs-toggle="collapse"
                  data-bs-target="#ContactUsDetails" aria-expanded="false" aria-controls="ContactUsDetails">
                  è¯çµ¡æˆ‘å€‘
                </button>
              </h2>
              <!-- ContactUsDetails -->
              <div id="ContactUsDetails" class="accordion-collapse collapse show" aria-labelledby="ContactUsSection">
                <div class="accordion-body">
                  <!-- è¯çµ¡ä¿¡ç®± -->
                  <div class="d-flex justify-content-between">
                    <p>è¯çµ¡ä¿¡ç®±</p>
                    <p>glow.2023@gmail.com</p>
                  </div>
                  <!-- è¯çµ¡é›»è©± -->
                  <div class="d-flex justify-content-between">
                    <p>è¯çµ¡é›»è©±</p>
                    <p>0988000999</p>
                  </div>
                  <!-- ç‡Ÿæ¥­æ™‚é–“ -->
                  <div class="d-flex justify-content-between mb-3">
                    <p>ç‡Ÿæ¥­æ™‚é–“</p>
                    <p>é€±ä¸€è‡³é€±äº” 09:00~17:00</p>
                  </div>
                  <!-- è³¼ç‰©ä¿è­‰ -->
                  <div class="row mb-3">
                    <div class="col d-flex flex-column align-items-center">
                      <span class="material-symbols-outlined fs-1 mb-3">
                        local_shipping
                      </span>
                      <span>å…è²»æ¨™æº–é…é€</span>
                    </div>
                    <div class="col d-flex flex-column align-items-center">
                      <span class="material-symbols-outlined fs-1 mb-3">
                        redeem
                      </span>
                      <span>ä¸ƒæ—¥å…§å…è²»é€€è²¨</span>
                    </div>
                    <div class="col d-flex flex-column align-items-center">
                      <span class="material-symbols-outlined fs-1 mb-3">
                        encrypted
                      </span>
                      <span>å®‰å…¨è³¼ç‰©</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- æ”¶ä»¶è³‡æ–™ -->
            <div class="accordion-item" v-if="cartsData.length !== 0">
              <!-- RecipientInformationSection -->
              <h2 class="accordion-header" id="RecipientInformationSection">
                <button class="accordion-button fs-5 fw-semibold" type="button" data-bs-toggle="collapse"
                  data-bs-target="#RecipientInformationDetails" aria-expanded="true"
                  aria-controls="RecipientInformationDetails">
                  æ”¶ä»¶è³‡æ–™
                </button>
              </h2>
              <!-- RecipientInformationDetails -->
              <div id="RecipientInformationDetails" class="accordion-collapse collapse show"
                aria-labelledby="RecipientInformationSection">
                <div class="accordion-body">
                  <v-form @submit="postOrder(orderData)" v-slot="{ errors }">
                    <!-- æ”¶ä»¶äººåç¨± -->
                    <div class="mb-3">
                      <label for="category" class="form-label">æ”¶ä»¶äººåç¨±</label>
                      <v-field type="text" name="æ”¶ä»¶äºº" class="form-control" :class="{ 'is-invalid': errors['æ”¶ä»¶äºº'] }"
                        rules="required|max:15" id="category" placeholder="è«‹å¡«å…¥æ”¶ä»¶äººçœŸå¯¦å§“åï¼Œä»¥ç¢ºä¿é †åˆ©æ”¶ä»¶"
                        v-model="orderData.data.user.name"></v-field>
                      <error-message class="invalid-feedback" name="æ”¶ä»¶äºº"></error-message>
                    </div>
                    <!-- é›»å­ä¿¡ç®± -->
                    <div class="mb-3">
                      <label for="email" class="form-label">é›»å­ä¿¡ç®±</label>
                      <v-field type="email" class="form-control" :class="{ 'is-invalid': errors['é›»å­ä¿¡ç®±'] }" id="email"
                        rules="email|required" name="é›»å­ä¿¡ç®±" placeholder="è«‹å¡«å…¥è¨‚å–®é€šçŸ¥Email (è¨‚å–®è³‡è¨Šå°‡ä»¥æ­¤E-mailé€šçŸ¥æ‚¨)"
                        v-model="orderData.data.user.email"></v-field>
                      <error-message class="invalid-feedback" name="é›»å­ä¿¡ç®±"></error-message>
                    </div>
                    <!-- è¡Œå‹•é›»è©±è™Ÿç¢¼ -->
                    <div class="mb-3">
                      <label for="phone" class="form-label">è¡Œå‹•é›»è©±è™Ÿç¢¼</label>
                      <v-field type="text" name="è¡Œå‹•é›»è©±" :rules="isPhone" class="form-control"
                        :class="{ 'is-invalid': errors['è¡Œå‹•é›»è©±'] }" id="phone" placeholder="è«‹å¡«å…¥æ”¶ä»¶äººè¡Œå‹•é›»è©±è™Ÿç¢¼ (ä¾›é…é€äººå“¡è¯çµ¡)"
                        v-model="orderData.data.user.tel"></v-field>
                      <error-message class="invalid-feedback" name="è¡Œå‹•é›»è©±"></error-message>
                    </div>
                    <!-- æ”¶ä»¶åœ°å€ -->
                    <div class="mb-3">
                      <label for="address" class="form-label">æ”¶ä»¶åœ°å€</label>
                      <v-field type="text" name="æ”¶ä»¶åœ°å€" class="form-control" :class="{ 'is-invalid': errors['æ”¶ä»¶åœ°å€'] }"
                        id="address" rules="required|max:50" placeholder="é€è²¨åœ°é»ç›®å‰åƒ…æä¾›ï¼šå°ç£ã€å°ç£å¤–å³¶å®…é…"
                        v-model="orderData.data.user.address"></v-field>
                      <error-message class="invalid-feedback" name="æ”¶ä»¶åœ°å€"></error-message>
                    </div>
                    <!-- è¨‚å–®å‚™è¨» -->
                    <div class="mb-3">
                      <p>è¨‚å–®å‚™è¨»</p>
                      <v-field as="textarea" name="è¨‚å–®å‚™è¨»" class="w-100 form-control"
                        :class="{ 'is-invalid': errors['è¨‚å–®å‚™è¨»'] }" id="orderMessage" name="orderMessage" rows="5"
                        placeholder="ç®¡ç†å®¤ä»£æ”¶/é›»è©±è¯çµ¡æ™‚é–“..." rules="max:800" v-model="orderData.data.message"></v-field>
                      <error-message class="invalid-feedback" name="è¨‚å–®å‚™è¨»"></error-message>
                    </div>
                    <!-- æ³¨æ„äº‹é … -->
                    <div class="form-check mb-3">
                      <input type="checkbox" class="form-check-input" id="is_enabled" v-model="checkOrderInfo">
                      <label for="is_enabled" class="form-check-label">
                        <span class="text-main-spec fw-bold">æˆ‘å·²ç¢ºèªä»¥ä¸‹å…§å®¹ï¼š</span>
                        <span><br>æé†’æ‚¨ï¼Œé€å‡ºè¨‚å–®å¾Œï¼Œå°‡ç„¡æ³•ä¿®æ”¹è¨‚å–®å…§å®¹ï¼Œä¸¦å‰å¾€ä»˜æ¬¾æµç¨‹ï¼Œè«‹æ‚¨ç¢ºå®šç„¡èª¤å¾Œå†é€å‡ºğŸ˜„</span>
                      </label>
                    </div>
                    <!-- å°æé†’ -->
                    <div class="bg-medium-gray text-deep-gray px-3 py-2 mb-3">
                      <h6>å…é‹æœå‹™</h6>
                      <span>æˆ‘å€‘çš„å•†å“ä»˜æ¬¾æ¡ç”¨ã€Œç·šä¸Šä¿¡ç”¨å¡ã€ä»˜æ¬¾å¾Œå‡ºè²¨ï¼Œé‹é€æ¡ç”¨ã€Œå®…é…åˆ°åºœã€å…é‹æœå‹™ï¼Œè®“æ‚¨è¼•é¬†è³¼è²·ã€å®‰å¿ƒæ”¶è²¨ã€‚</span>
                    </div>
                    <!-- çµå¸³æŒ‰éˆ• -->
                    <div class="d-flex mb-3">
                      <button type="submit" class="btn btn-solid-spec w-100 btn-lg"
                        :disabled="!checkOrderInfo">çµå¸³</button>
                    </div>
                  </v-form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Vue CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- VueDemiï¼Œä½¿ç”¨ Pinia å¿…è¦çš„ç›¸ä¾å¥—ä»¶ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-demi/0.13.11/index.iife.js"></script>
  <script>const I = VueDemi; const vueDemi = VueDemi;</script>
  <!-- Pinia ç¶²é ç‰ˆï¼Œå¯¦æˆ°ä¸­é‚„æ˜¯ä»¥ npm ç‚ºä¸»ï¼Œé€™æ˜¯æ¯”è¼ƒå°‘è¦‹çš„ä½¿ç”¨æ–¹å¼ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pinia/2.0.28/pinia.iife.js"></script>
  <!-- bootStrapJs -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- vueLoadingJs -->
  <script src="https://cdn.jsdelivr.net/npm/vue-loading-overlay@6.0.3/dist/index.min.js"></script>
  <!-- veeValidation ç›¸é—œå¥—ä»¶ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vee-validate/4.12.4/vee-validate.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@vee-validate/rules@4.12.4/dist/vee-validate-rules.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@vee-validate/i18n@4.12.4/dist/vee-validate-i18n.min.js"></script>
  <!-- axios -->
  <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
  <!-- å¼•å…¥æœ¬åœ° checkout.js -->
  <script src="./checkout.js" type="module"></script>
</body>

</html>